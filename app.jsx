import { useState } from 'react';
import './index.css';
import { PieChart } from 'react-minimal-pie-chart';
import Chart from 'react-apexcharts';

// STYLES
const styles = {
    container: { width: '100%', maxWidth: '1200px', display: 'flex', flexDirection: 'column', alignItems: 'center', margin: '0 auto' },
    header: { fontSize: '2.5rem', fontWeight: '700', color: 'var(--text-primary)', textShadow: '0 0 15px var(--accent-color-translucent)', marginBottom: '20px', textAlign: 'center' },
    inputPanel: { width: '100%', maxWidth: '600px', backgroundColor: 'var(--panel-background)', border: '1px solid var(--border-color)', borderRadius: '12px', padding: '25px', marginBottom: '30px', boxShadow: '0 10px 30px rgba(0, 0, 0, 0.2)' },
    form: { display: 'flex', gap: '15px' },
    input: { flexGrow: 1, backgroundColor: '#0D1117', border: '1px solid var(--border-color)', color: 'var(--text-primary)', borderRadius: '8px', padding: '14px', fontSize: '1rem' },
    button: { backgroundColor: 'var(--accent-color)', color: '#0D1117', border: 'none', padding: '14px 25px', fontWeight: '700', borderRadius: '8px', cursor: 'pointer' },
    loader: { width: '48px', height: '48px', border: '3px solid var(--text-secondary)', borderTopColor: 'var(--accent-color)', borderRadius: '50%', animation: 'rotation 1s linear infinite', margin: '30px auto' },
    card: { backgroundColor: 'var(--panel-background)', border: '1px solid var(--border-color)', borderRadius: '12px', padding: '20px', cursor: 'pointer', transition: 'transform 0.2s, box-shadow 0.2s, border-color 0.2s' },
    cardHeader: { display: 'flex', justifyContent: 'space-between', alignItems: 'baseline', borderBottom: '1px solid var(--border-color)', paddingBottom: '10px', marginBottom: '15px' },
    tickerSymbol: { fontSize: '1.75rem', fontWeight: '700', color: 'var(--text-primary)' },
    growthScore: { fontSize: '1.75rem', fontWeight: '700', color: 'var(--accent-color)' },
    scoreRow: { display: 'grid', gridTemplateColumns: '100px 1fr 60px', alignItems: 'center', gap: '10px', fontSize: '0.9rem', marginBottom: '8px' },
    scoreLabel: { color: 'var(--text-secondary)' },
    scoreBarContainer: { width: '100%', height: '8px', backgroundColor: '#0D1117', borderRadius: '4px', overflow: 'hidden' },
    scoreBarFill: { height: '100%', borderRadius: '4px' },
    scoreValue: { fontWeight: '600', textAlign: 'right', color: 'var(--text-primary)' },
    backButton: { alignSelf: 'flex-start', background: 'var(--panel-background)', border: '1px solid var(--border-color)', color: 'var(--text-primary)', padding: '10px 20px', borderRadius: '8px', cursor: 'pointer', marginBottom: '20px', fontWeight: '600' },
    detailPanel: { backgroundColor: 'var(--panel-background)', border: '1px solid var(--border-color)', padding: '20px', borderRadius: '12px' },
    detailRow: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '12px 0', borderBottom: '1px solid #161b22' },
    panelHeader: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', borderBottom: '1px solid var(--border-color)', paddingBottom: '10px', marginBottom: '15px' },
    panelTitle: { color: 'var(--text-primary)', margin: 0, fontSize: '1.25rem', fontWeight: '600' },
    panelScore: { fontSize: '1.25rem', fontWeight: '700', color: 'var(--accent-color)' },
    verdictBadge: { padding: '4px 12px', borderRadius: '12px', fontWeight: '700', fontSize: '1rem', marginLeft: '15px' },
    verdictPillsContainer: { display: 'flex', gap: '10px', marginBottom: '15px', flexWrap: 'wrap' },
    verdictPill: { display: 'flex', alignItems: 'center', gap: '6px', padding: '4px 12px', borderRadius: '16px', fontWeight: '600', fontSize: '0.9rem' },
    momentumBadge: { padding: '4px 12px', borderRadius: '12px', fontWeight: '700', fontSize: '1rem', marginLeft: '10px', backgroundColor: 'rgba(139, 92, 246, 0.2)', color: '#a78bfa', border: '1px solid #6d28d9' },
    momentumPill: { backgroundColor: 'rgba(139, 92, 246, 0.2)', color: '#a78bfa' },
};
const keyframes = `@keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }`;
const styleSheet = document.createElement("style");
styleSheet.innerText = keyframes;
document.head.appendChild(styleSheet);

// UTILITY FUNCTIONS
const formatCurrency = (val) => { if (val == null) return 'N/A'; if (val >= 1e9) return `$${(val / 1e9).toFixed(2)}B`; if (val >= 1e6) return `$${(val / 1e6).toFixed(2)}M`; return `$${val.toFixed(2)}`; };
const formatNum = (val, dec = 2) => val != null ? val.toFixed(dec) : 'N/A';
const formatBigNum = (val) => val != null ? Math.round(val).toLocaleString() : 'N/A';
const formatPercent = (val, dec = 2) => val != null ? `${(val * 100).toFixed(dec)}%` : 'N/A';
const formatSimpleCurrency = (val) => val != null ? `$${val.toFixed(2)}` : 'N/A';
const getVerdictStyle = (verdict = '') => { const v = verdict.toLowerCase(); if (v.includes('bullish')) return { backgroundColor: 'var(--accent-color)', color: '#0D1117' }; if (v.includes('bearish')) return { backgroundColor: 'var(--danger-color)', color: '#0D1117' }; return { backgroundColor: 'var(--border-color)', color: 'var(--text-primary)' }; };
const getScoreBarColor = (score) => { if (score > 0.65) return 'var(--accent-color)'; if (score > 0.45) return '#E8D44D'; return '#DD6B20'; };


// ALL PANEL COMPONENTS ARE UNCHANGED
const MacroPanel = ({ stock }) => { const details = stock?.['Macro Details'] ?? {}; const score = stock?.['Macro Score'] ?? 0; const sectorClassification = details.sector_classification || 'N/A'; const currentMacroState = details.current_macro_state || 'N/A'; const cycleData = [ { title: 'Expansion', types: ['Growth', 'Cyclical Growth', 'Cyclical'] }, { title: 'Peak', types: ['Defensive Growth', 'Diversified'] }, { title: 'Contraction', types: ['Defensive', 'Utilities', 'Consumer Defensive'] }, { title: 'Trough', types: ['Cyclical Value', 'Financial Services'] } ]; const idealCycleStage = cycleData.find(c => c.types.includes(sectorClassification))?.title || 'N/A'; return ( <div style={styles.detailPanel}><div style={styles.panelHeader}><h3 style={styles.panelTitle}>Macro Environment Fit</h3><span style={styles.panelScore}>{Math.round(score * 100)}</span></div><div style={{...styles.cycleBoxContainer}}>{cycleData.map(box => { const isIdealStage = box.title === idealCycleStage; const isCurrentStage = box.title === currentMacroState; const boxStyle = { ...styles.cycleBox, ...(isCurrentStage && {border:'2px solid var(--accent-color)'}), ...(isIdealStage && {...styles.cycleBoxActive}) }; return ( <div key={box.title} style={boxStyle}><span style={{...styles.cycleBoxTitle, ...(isIdealStage && {...styles.cycleBoxTitleActive})}}>{box.title}{isCurrentStage && !isIdealStage && <span style={{fontSize: '0.8rem', fontWeight: 'normal'}}> (Current)</span>}</span><ul style={{...styles.sectorTypeList}}>{box.types.map(type => ( <li key={type} style={{...(type === sectorClassification && !isIdealStage && {...styles.sectorTypeHighlight}), ...(isIdealStage && {color:'#0d1117'})}}>{type}</li> ))}</ul></div> ); })}</div><div style={styles.detailRow}><span>Ideal Cycle Stage</span><strong>{idealCycleStage}</strong></div><div style={{...styles.detailRow, borderBottom: 'none'}}><span>Technology Sector Classification</span><strong style={{color: 'var(--accent-color)'}}>{sectorClassification}</strong></div></div> );};
const BalanceSheetPanel = ({ stock }) => { const details = stock?.['Financials Details'] ?? {}; const totalAssets = details.totalAssets || 0; const totalDebt = details.totalDebt || 0; const totalEquity = details.stockholderEquity || 0; const debtPct = totalAssets > 0 ? totalDebt / totalAssets : 0; const equityPct = totalAssets > 0 ? totalEquity / totalAssets : 0; const chartData = [ { title: 'Equity', value: equityPct * 100, color: 'var(--accent-color)' }, { title: 'Debt', value: debtPct * 100, color: 'var(--danger-color)' } ]; const LegendRow = ({ label, value, percentage, color }) => ( <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '8px 0', fontSize: '0.9rem' }}><div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}><span style={{ width: '12px', height: '12px', backgroundColor: color, borderRadius: '3px' }}></span><span>{label}</span></div><strong style={{ color: color }}>{value} ({percentage})</strong></div> ); return ( <div style={styles.detailPanel}><div style={styles.panelHeader}><h3 style={styles.panelTitle}>Balance Sheet Visualization</h3></div><div style={{ display: 'flex', alignItems: 'center', gap: '25px', padding: '10px 0px' }}><div style={{ position: 'relative', width: '100px', height: '100px', flexShrink: 0 }}><PieChart data={chartData} lineWidth={20} startAngle={-90} background="#161b22" /><div style={{...styles.pieChartLabel}}>Assets</div></div><div style={{ flex: 1 }}><LegendRow label="Total Assets" value={formatCurrency(totalAssets)} percentage={formatPercent(1, 2)} color="var(--text-primary)" /><LegendRow label="Total Equity" value={formatCurrency(totalEquity)} percentage={formatPercent(equityPct, 2)} color="var(--accent-color)" /><LegendRow label="Total Liabilities (Debt)" value={formatCurrency(totalDebt)} percentage={formatPercent(debtPct, 2)} color="var(--danger-color)" /></div></div></div> ); };
const FundamentalsPanel = ({ stock }) => { const score = stock?.['Financials Score'] ?? 0; const details = stock?.['Financials Details'] ?? {}; const FundamentaMetric = ({ label, value, formatter = (v) => v }) => (<div style={styles.detailRow}><span style={{color: 'var(--text-secondary)'}}>{label}</span><strong style={{color: 'var(--text-primary)'}}>{formatter(value)}</strong></div>); return ( <div style={styles.detailPanel}><div style={styles.panelHeader}><h3 style={styles.panelTitle}>Fundamental Analysis</h3><span style={styles.panelScore}>{Math.round(score * 100)}</span></div><FundamentaMetric label="YoY Revenue Growth" value={details.revenue_growth_yoy} formatter={formatPercent} /><FundamentaMetric label="P/E Ratio" value={details.pe_ratio} formatter={formatNum} /><FundamentaMetric label="P/B Ratio" value={details.priceToBook} formatter={formatNum} /><FundamentaMetric label="Debt to Equity" value={details.de_ratio} formatter={formatNum} /><FundamentaMetric label="Return on Equity" value={details.roe} formatter={formatPercent} /><FundamentaMetric label="Profit Margin" value={details.profit_margin} formatter={formatPercent} /></div> );};
const TechnicalsPanel = ({ stock }) => { const score = stock?.['Technicals Score'] ?? 0; const details = stock?.['Technicals Details'] ?? {}; const macdIsBullish = details.macd_line > details.signal_line; const MetricRow = ({ label, value, color }) => ( <div style={{...styles.detailRow, padding: '10px 0', borderBottom: '1px solid #161b2280' }}> <span style={{color: 'var(--text-secondary)'}}>{label}</span> <strong style={{color: color || 'var(--text-primary)'}}>{value}</strong> </div> ); return ( <div style={styles.detailPanel}> <div style={styles.panelHeader}> <h3 style={styles.panelTitle}>Technicals</h3> <span style={styles.panelScore}>{Math.round(score * 100)}</span> </div> <div style={{ padding: '10px 0 15px 0' }}> <div className="priceRangeLabels"> <span>{formatSimpleCurrency(details.fiftyTwoWeekLow)}</span> <span style={{color: 'var(--text-primary)', fontWeight: 600}}>52-Week Range</span> <span>{formatSimpleCurrency(details.fiftyTwoWeekHigh)}</span> </div> <div className="priceRangeContainer"> <div className="priceRangeBar"></div> <div className="priceRangeMarker" style={{left: `${((details.current_price - details.fiftyTwoWeekLow) / (details.fiftyTwoWeekHigh - details.fiftyTwoWeekLow)) * 100}%`}}></div> </div> </div> <MetricRow label="Current Price" value={formatSimpleCurrency(details.current_price)} color="var(--accent-color)" /> <MetricRow label="50-Day MA" value={formatSimpleCurrency(details.ma50)} /> <MetricRow label="200-Day MA" value={formatSimpleCurrency(details.ma200)} /> <MetricRow label="RSI (14)" value={formatNum(details.rsi, 2)} /> <MetricRow label="MACD" value={macdIsBullish ? 'Bullish' : 'Bearish'} color={macdIsBullish ? 'var(--accent-color)' : 'var(--danger-color)'} /> <MetricRow label="ATR (Volatility)" value={formatSimpleCurrency(details.atr)} /> </div> ); };
const PriceTrendPanel = ({ stock }) => { const details = stock?.['Technicals Details'] ?? {}; const priceData = (details.price_history || []).slice(-6); const isUp = priceData.length > 1 ? priceData[priceData.length - 1][1] >= priceData[0][1] : true; const series = [{ name: 'Price', data: priceData }]; const options = { chart: { type: 'area', toolbar: { show: false }, zoom: { enabled: false }, animations: { enabled: true } }, dataLabels: { enabled: false }, stroke: { curve: 'smooth', width: 3 }, colors: [isUp ? 'var(--accent-color)' : 'var(--danger-color)'], fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.5, opacityTo: 0.1, stops: [0, 100] }}, tooltip: { theme: 'dark', style: { fontSize: '12px' }, x: { format: 'ddd, MMM dd' }, y: { formatter: (val) => `$${val.toFixed(2)}` }}, grid: { show: false }, xaxis: { type: 'datetime', labels: { show: false }, axisBorder: { show: false }, axisTicks: { show: false }, tooltip: { enabled: false }}, yaxis: { labels: { show: false }, axisBorder: { show: false }, axisTicks: { show: false }}, }; return (<div style={{...styles.detailPanel, padding: '0', background: 'transparent', border: 'none'}}><Chart options={options} series={series} type="area" height={280} /></div>); };
const SentimentPanel = ({ stock }) => { const score = stock?.['Sentiment LLM Score'] ?? 0; const details = stock?.['Sentiment Details'] ?? {}; return ( <div style={styles.detailPanel}><div style={styles.panelHeader}><h3 style={styles.panelTitle}>Sentiment Analysis</h3><span style={styles.panelScore}>{Math.round(score * 100)}</span></div><div style={styles.detailRow}><span>Analyst Consensus</span><strong>{details.analyst_rating_text}</strong></div><div style={{padding: '10px 0'}}><span style={{fontWeight:600}}>AI Sentiment on Recent Headlines</span></div>{details.analyzed_articles?.length > 0 ? (details.analyzed_articles.map((article, i) => (<div key={i} style={{borderLeft: `3px solid hsl(${article.score*120}, 100%, 50%)`, paddingLeft: '10px', margin: '10px 0'}}><span>{article.title}</span><p style={{fontSize:'0.8rem', color:'var(--text-secondary)', margin:'5px 0 0'}}>{article.justification} - <a href={article.url} target="_blank" rel="noopener noreferrer" style={{color: 'var(--accent-color)'}}>Read →</a></p></div>))) : <p>No news articles found.</p>}</div> );};
const PerformanceAndStatsPanel = ({ stock }) => { const techDetails = stock?.['Technicals Details'] ?? {}; const finDetails = stock?.['Financials Details'] ?? {}; const formatPerf = (value) => { if (value == null) return <span style={{color: 'var(--text-secondary)'}}>N/A</span>; const percent = value * 100; const color = percent >= 0 ? 'var(--accent-color)' : 'var(--danger-color)'; return <span style={{ color, fontWeight: '600' }}>{percent.toFixed(1)}%</span>; }; return ( <div style={styles.detailPanel}> <div style={styles.panelHeader}><h3 style={styles.panelTitle}>Performance & Stats</h3></div> <div style={styles.detailRow}><span>Market Cap</span><strong>{formatCurrency(finDetails.marketCap)}</strong></div> <div style={{height:'10px'}}></div> <div style={styles.panelHeader}><h3 style={{...styles.panelTitle, fontSize:'1.1rem'}}>Trailing Performance</h3></div> <div style={styles.detailRow}><span>1-Week</span><strong>{formatPerf(techDetails.performance_1w)}</strong></div> <div style={styles.detailRow}><span>1-Month</span><strong>{formatPerf(techDetails.performance_1m)}</strong></div> <div style={styles.detailRow}><span>3-Month</span><strong>{formatPerf(techDetails.performance_3m)}</strong></div> <div style={styles.detailRow}><span>YTD</span><strong>{formatPerf(techDetails.performance_ytd)}</strong></div> <div style={styles.detailRow}><span>1-Year</span><strong>{formatPerf(techDetails.performance_1y)}</strong></div> <div style={{...styles.detailRow, borderBottom:'none'}}><span>1-Yr vs S&P 500</span><strong>{formatPerf(techDetails.performance_vs_sp500_1y)}</strong></div> </div> );};
const SeasonalityPanel = ({ stock }) => { const details = stock?.['Seasonality Details'] ?? {}; const verdict = details.verdict || 'Neutral'; const reason = details.reason || 'No significant seasonal pattern found.'; const verdictColor = verdict.toLowerCase().includes('bullish') ? 'var(--accent-color)' : verdict.toLowerCase().includes('bearish') ? 'var(--danger-color)' : 'var(--text-secondary)'; return ( <div style={styles.detailPanel}> <div style={styles.panelHeader}> <h3 style={styles.panelTitle}>Seasonality</h3> <span style={{ color: verdictColor, fontSize: '1.1rem', fontWeight: 700 }}>{verdict}</span> </div> <div style={{ padding: '5px 0' }}> <p style={{ color: 'var(--text-secondary)', fontSize: '0.9rem', margin: '0 0 15px 0', lineHeight: 1.5 }}> {reason} </p> <div style={styles.detailRow}><span style={{color: 'var(--text-secondary)'}}>Historical Win Rate</span><strong>{formatPercent(details.win_rate, 0) ?? 'N/A'}</strong></div> <div style={{...styles.detailRow, borderBottom: 'none'}}><span style={{color: 'var(--text-secondary)'}}>Avg. Monthly Return</span><strong>{formatPercent(details.avg_monthly_return) ?? 'N/A'}</strong></div> </div> </div> );};


// --- CORE COMPONENTS ---
const DetailedView = ({ stock, onBack }) => { const [activeMobilePanel, setActiveMobilePanel] = useState(null); const panelCategories = [ { id: 'technicals', title: 'Technicals', color: '#8b5cf6', score: Math.round((stock['Technicals Score'] || 0) * 100), Component: TechnicalsPanel, icon: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h12M3.75 3h16.5M3.75 3v5.25M19.5 3v5.25M9 13.5l3 3m0 0l3-3m-3 3v-6" /></svg> }, { id: 'fundamentals', title: 'Fundamentals', color: '#ec4899', score: Math.round((stock['Financials Score'] || 0) * 100), Component: FundamentalsPanel, icon: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> }, { id: 'macro', title: 'Macro', color: '#10b981', score: Math.round((stock['Macro Score'] || 0) * 100), Component: MacroPanel, icon: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A11.953 11.953 0 0012 13.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 003 12c0 .778.099 1.533.284 2.253m18.132-4.5A11.966 11.966 0 0112 15c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12" /></svg> }, { id: 'balance_sheet', title: 'Balance Sheet', color: '#0ea5e9', Component: BalanceSheetPanel, icon: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 3v18M12 3l-2.024.908a.75.75 0 00-.435.158l-6.25 4.5a.75.75 0 00-.191 1.053l2.25 3.75a.75.75 0 001.053.191l3.75-2.25M12 3l2.024.908a.75.75 0 01.435.158l6.25 4.5a.75.75 0 01.191 1.053l-2.25 3.75a.75.75 0 01-1.053.191l-3.75-2.25m-2.25 9.191l-3.75 2.25a.75.75 0 01-1.053-.191L3.28 16.5a.75.75 0 01.191-1.053l6.25-4.5a.75.75 0 01.435-.158L12 10.5m0 3.691l2.25-1.35m-2.25 1.35l-3.75-2.25M12 10.5l3.75 2.25m-3.75-2.25l2.25 1.35m0 0l-3.75 2.25m3.75-2.25l3.75-2.25m-6 4.5l-3.75 2.25m3.75-2.25l3.75 2.25" /></svg> }, { id: 'sentiment', title: 'Sentiment', color: '#f59e0b', score: Math.round((stock['Sentiment LLM Score'] || 0) * 100), Component: SentimentPanel, icon: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 013-3h.008c1.657 0 3.002 1.343 3.002 3L15 12.75a3 3 0 01-3 3h-.008z" /></svg> }, { id: 'seasonality', title: 'Seasonality', color: '#14b8a6', Component: SeasonalityPanel, icon: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0h18M12 12.75h.008v.008H12v-.008z" /></svg> }, { id: 'performance', title: 'Performance', color: '#6366f1', Component: PerformanceAndStatsPanel, icon: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941" /></svg> }, ]; const ActiveComponent = panelCategories.find(p => p.id === activeMobilePanel)?.Component; return ( <div style={{...styles.container, padding: 0, width: '100%'}}> <div className="detailed-view-header"> <button onClick={onBack} style={{...styles.backButton, marginBottom: '20px', width: 'auto', alignSelf:'center' }}>← Back to All Results</button> <h1 style={{...styles.tickerSymbol, fontSize: '2rem', textAlign: 'center'}}>{stock.Ticker} Full Breakdown</h1> <div className="header-badges"> <span style={styles.growthScore}>Growth Score: {formatPercent(stock['Growth Score'], 2)}</span> {stock['Momentum Details']?.bonus > 0 && <span style={styles.momentumBadge} title={stock['Momentum Details']?.reason}>Momentum Bonus</span>} <span style={{...styles.verdictBadge, ...getVerdictStyle(stock['Final Verdict'])}}>{stock['Final Verdict']}</span> </div> </div> <div className="desktop-only"> <div className="detailed-grid"> <div className="left-column"> <MacroPanel stock={stock} /> <BalanceSheetPanel stock={stock} /> <FundamentalsPanel stock={stock} /> <SentimentPanel stock={stock} /> </div> <div className="right-column"> <PriceTrendPanel stock={stock} /> <TechnicalsPanel stock={stock} /> <PerformanceAndStatsPanel stock={stock} /> <SeasonalityPanel stock={stock} /> </div> </div> </div> <div className="mobile-only"> {!activeMobilePanel ? ( <div className="category-grid"> {panelCategories.filter(p => p.id !== 'performance').map(panel => ( <button key={panel.id} className="category-button" style={{ '--category-color': panel.color }} onClick={() => setActiveMobilePanel(panel.id)}> <div className="category-button-header"> <span className="category-button-icon">{panel.icon}</span> <span className="category-button-title">{panel.title}</span> </div> {panel.score != null && <span className="category-button-score">{panel.score}</span>} </button> ))} <button className="category-button-full" style={{ '--category-color': '#6366f1' }} onClick={() => setActiveMobilePanel('performance')}> <div className="category-button-header"> <span className="category-button-icon">{panelCategories.find(p => p.id === 'performance').icon}</span> <span className="category-button-title">Performance & Stats</span> </div> </button> </div> ) : ( <div className="mobile-panel-view"> <button onClick={() => setActiveMobilePanel(null)} className="mobile-back-button"> ← Back to Overview </button> <ActiveComponent stock={stock} /> </div> )} </div> </div> );};
const ResultCard = ({ data, onSelect }) => { const sentimentScore = ((data['Sentiment LLM Score'] || 0) + (data['Sentiment Analyst Score'] || 0) + (data['Sentiment Social Score'] || 0)) / 3; const scores = [ { label: 'Financials', value: data['Financials Score'] || 0 }, { label: 'Technicals', value: data['Technicals Score'] || 0 }, { label: 'Sentiment', value: sentimentScore }, { label: 'Macro', value: data['Macro Score'] || 0 } ]; const finalVerdict = data['Final Verdict'] || 'Neutral'; const seasonalityVerdict = data['Seasonality Details']?.verdict || 'Neutral'; const momentumBonus = data['Momentum Details']?.bonus > 0; return ( <div style={styles.card} className="result-card" onClick={() => onSelect(data)}> <div style={styles.cardHeader}> <span style={styles.tickerSymbol}>{data.Ticker}</span> <span style={styles.growthScore}>{formatPercent(data['Growth Score'], 2)}</span> </div> <div style={styles.verdictPillsContainer}> <div style={{...styles.verdictPill, ...getVerdictStyle(finalVerdict)}}>{finalVerdict}</div> <div style={{...styles.verdictPill, ...getVerdictStyle(seasonalityVerdict)}}>{`Seasonality: ${seasonalityVerdict}`}</div> {momentumBonus && <div style={{...styles.verdictPill, ...styles.momentumPill}}>Momentum</div>} </div> {scores.map(s => ( <div key={s.label} style={styles.scoreRow}> <span style={styles.scoreLabel}>{s.label}</span> <div style={styles.scoreBarContainer}> <div style={{...styles.scoreBarFill, width: `${s.value * 100}%`, backgroundColor: getScoreBarColor(s.value) }}></div> </div> <span style={styles.scoreValue}>{formatPercent(s.value, 2)}</span> </div> ))} </div> );};
const MainView = ({ onAnalyze, onTickersChange, tickers, loading, error, results, onSelectStock }) => ( <div className="main-view-container"> <h1 style={styles.header}>AI Powered Pocket Analyst</h1> <div style={styles.inputPanel}> <form className="form" onSubmit={onAnalyze}> <input type="text" value={tickers} onChange={onTickersChange} placeholder="e.g., NVDA, MSFT, AAPL" style={styles.input} /> <button type="submit" style={styles.button} disabled={loading}>Analyze</button> </form> </div> {loading && <div style={styles.loader}></div>} {error && <div>{error}</div>} {results.length > 0 && <div className="resultsContainer">{results.map(result => (<ResultCard key={result.Ticker} data={result} onSelect={onSelectStock} />))}</div>} </div> );
function App() { const [tickers, setTickers] = useState(''); const [results, setResults] = useState([]); const [loading, setLoading] = useState(false); const [error, setError] = useState(''); const [selectedStock, setSelectedStock] = useState(null); const API_URL = 'https://stock-rater-backend-api.onrender.com/analyze'; const handleAnalyze = async (e) => { e.preventDefault(); const tickerList = tickers.split(',').map(t => t.trim().toUpperCase()).filter(Boolean); if (!tickerList.length) return; setLoading(true); setError(''); setResults([]); const analyzeTicker = async (ticker) => { try { const response = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ tickers: [ticker] }) }); if (!response.ok) throw new Error(`Network error for ${ticker}`); const data = await response.json(); if (data.results && data.results.length > 0) {  return data.results[0]; } else { return { Ticker: ticker, 'Growth Score': 0, error: 'No results from API', 'Final Verdict': 'Error' }; } } catch (err) { console.error(`Failed to analyze ${ticker}:`, err); return { Ticker: ticker, 'Growth Score': 0, error: err.message, 'Final Verdict': 'Error' }; } }; const allResults = await Promise.all(tickerList.map(ticker => analyzeTicker(ticker))); const sortedResults = allResults.sort((a, b) => (b['Growth Score'] || 0) - (a['Growth Score'] || 0)); setResults(sortedResults); setLoading(false); }; return ( <div style={styles.container}> {selectedStock ? <DetailedView stock={selectedStock} onBack={() => setSelectedStock(null)} /> : <MainView onAnalyze={handleAnalyze} onTickersChange={(e) => setTickers(e.target.value)} tickers={tickers} loading={loading} error={error} results={results} onSelectStock={setSelectedStock} /> } </div> );}

export default App;
